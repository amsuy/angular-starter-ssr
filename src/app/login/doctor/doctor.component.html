<div class="doctor-dashboard">
  <!-- Sidebar Fija -->
  <div class="sidebar">

    <img src="assets/img/logo.png" alt="Hospital Logo" class="logo" />
    <div class="user-info">ğŸ‘¨â€âš•ï¸ {{ username }}</div>

    <button (click)="mostrarSeccion('estado')">ğŸ“Œ Citas por Estado</button>
    <button (click)="mostrarSeccion('nitEstado')">ğŸ” Por NIT y Estado</button>
    <button (click)="mostrarSeccion('rangoFechas')">ğŸ“† Rango de Fechas</button>
    <button (click)="mostrarSeccion('hoyColegiado')">ğŸ“Ÿ Hoy por Colegiado</button>
    <button (click)="mostrarSeccion('historialColegiado')">ğŸ“‰ Historial por Colegiado</button>
    <button (click)="mostrarSeccion('finalizarCita')">âœ… Cambiar Cita a Realizada</button>
    <button (click)="mostrarSeccion('buscarPacienteNit')">ğŸ§ Buscar Paciente por NIT</button>
    <!-- Botones adicionales con el mismo estilo -->
    <button (click)="limpiarPantalla()">ğŸ§¹ Refrescar Pantalla</button>
    <button (click)="cerrarSesion()">â¬… Cerrar SesiÃ³n</button>


  </div>

  <!-- Contenido Principal -->
  <div class="main-content">
    <div class="panel-header">ğŸ©º Panel del Doctor</div>

    <!-- Secciones dinÃ¡micas -->
    <div *ngIf="seccionActiva === 'estado'">
      <h2>ğŸ“Œ Citas por Estado</h2>
      <select [(ngModel)]="estado">
        <option value="" disabled selected>Selecciona el estado</option>
        <option value="PROGRAMADA">ğŸ“Œ PROGRAMADA</option>
        <option value="REALIZADA">âœ… REALIZADA</option>
        <option value="CANCELADA">âŒ CANCELADA</option>
      </select>
      <button (click)="consultarCitasPorEstado()">Buscar</button>
      <button class="btn-limpiar" (click)="limpiarCamposEstado()">ğŸ§½ Limpiar</button>
    </div>

    <div *ngIf="seccionActiva === 'nitEstado'">
      <h2>ğŸ” Consultar por NIT y Estado</h2>
      <input type="number" [(ngModel)]="nitPaciente" placeholder="NIT del Paciente" />
      <select [(ngModel)]="estado">
        <option value="" disabled selected>Selecciona el estado</option>
        <option value="PROGRAMADA">ğŸ“Œ PROGRAMADA</option>
        <option value="REALIZADA">âœ… REALIZADA</option>
        <option value="CANCELADA">âŒ CANCELADA</option>
      </select>
      <button (click)="consultarCitasPorNitYEstado()">Buscar</button>
      <button class="btn-limpiar" (click)="limpiarCamposNitYEstado()">ğŸ§½ Limpiar</button>
    </div>

    <div *ngIf="seccionActiva === 'rangoFechas'">
      <h2>ğŸ“† Consultar por Citas por Rango de Fechas</h2>
      <input type="datetime-local" [(ngModel)]="fechaInicio" placeholder="Fecha Inicio" />
      <input type="datetime-local" [(ngModel)]="fechaFin" placeholder="Fecha Fin" />
      <button (click)="consultarCitasPorRangoFechas()">Buscar</button>
      <button class="btn-limpiar" (click)="limpiarCamposRangoFechas()">ğŸ§½ Limpiar</button>
    </div>

    <div *ngIf="seccionActiva === 'hoyColegiado'">
      <h2>ğŸ§¾ Citas de Hoy por Colegiado</h2>
      <input [(ngModel)]="colegiado" placeholder="Colegiado" />
      <button (click)="consultarCitasDeHoyPorColegiado()">Buscar</button>
      <button class="btn-limpiar" (click)="limpiarCamposHoyColegiado()">ğŸ§½ Limpiar</button>
    </div>

    <div *ngIf="seccionActiva === 'historialColegiado'">
      <h2>ğŸ“‰ Historial por Colegiado</h2>
      <input [(ngModel)]="colegiado" placeholder="Colegiado" />
      <input type="date" [(ngModel)]="fechaInicio" placeholder="Fecha Inicio" />
      <input type="date" [(ngModel)]="fechaFin" placeholder="Fecha Fin" />
      <button (click)="consultarHistorialPorColegiado()">Buscar</button>
      <button class="btn-limpiar" (click)="limpiarCamposHistorialColegiado()">ğŸ§½ Limpiar</button>
    </div>

    <div *ngIf="seccionActiva === 'finalizarCita'">
      <h2>âœ… Finalizar Cita</h2>

      <label for="idCita">ğŸ†” ID de la Cita:</label>
      <input id="idCita" [(ngModel)]="idCitaFinalizar" type="number" placeholder="Ej. 25" />

      <label for="costoCita">ğŸ’° Costo de la Cita (Q):</label>
      <input id="costoCita" [(ngModel)]="costoCita" type="number" placeholder="Ej. 100" />

      <label for="fechaFinCita">ğŸ—“ï¸ Fecha de FinalizaciÃ³n:</label>
      <input id="fechaFinCita" [(ngModel)]="fechaFinCita" type="datetime-local" />

      <div class="botonera-modal-finalizar">
        <button class="btn-finalizar" (click)="finalizarCita()">Finalizar</button>
        <button class="btn-limpiar" (click)="limpiarCamposFinalizarCita()">ğŸ§½ Limpiar</button>
      </div>
    </div>


    <div *ngIf="seccionActiva === 'buscarPacienteNit'">
      <h2>ğŸ§ Buscar Paciente por NIT</h2>
      <input type="number" [(ngModel)]="nitPaciente" placeholder="Ingrese NIT del paciente" />
      <button (click)="buscarPacientesPorNit()">Buscar</button>
      <button class="btn-limpiar" (click)="limpiarCamposPacientePorNit()">ğŸ§½ Limpiar</button>

      <div *ngIf="pacientes.length > 0" class="tabla-scroll">
        <table class="tabla-citas">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Edad</th>
              <th>NIT</th>
              <th>CUI</th>
              <th>DirecciÃ³n</th>
              <th>TelÃ©fono</th>
              <th>Fecha</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let p of pacientes">
              <td>{{ p.nombrecompleto }}</td>
              <td>{{ p.edad }}</td>
              <td>{{ p.nit }}</td>
              <td>{{ p.cui }}</td>
              <td>{{ p.direccion }}</td>
              <td>{{ p.telefono }}</td>
              <td>{{ p.fecha | date:'dd/MM/yyyy' }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div *ngIf="citas.length > 0" class="resultados">
      <h2>ğŸ“‹ Resultados de Citas</h2>
      <table class="tabla-citas">
        <thead>
          <tr>
            <th>Id Cita</th>
            <th>Paciente</th>
            <th>NIT</th>
            <th>Doctor</th>
            <th>Colegiado</th>
            <th>Fecha</th>
            <th>Motivo</th>
            <th>Estado</th>
            <th>Costo</th>
            <th>Fin</th>
            <th>Motivo Cancelacion</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let c of citas">
            <td>{{ c.idcita }}</td>
            <td>{{ c.nombrecompletoPaciente }}</td>
            <td>{{ c.nit }}</td>
            <td>{{ c.nombrecompletoDoctor }}</td>
            <td>{{ c.colegiado }}</td>
            <td>{{ c.fechacita | date:'dd/MM/yyyy HH:mm' }}</td>
            <td>{{ c.motivoconsulta }}</td>
            <td>
              <span [ngClass]="{
                'estado-programada': c.estado === 'PROGRAMADA',
                'estado-realizada': c.estado === 'REALIZADA',
                'estado-cancelada': c.estado === 'CANCELADA'
              }">{{ c.estado }}</span>
            </td>
            <td>{{ c.costo || '---' }}</td>
            <td>{{ c.fechaFin ? (c.fechaFin | date:'dd/MM/yyyy HH:mm') : '---' }}</td>
            <td>{{ c.motivocancelacion || '---'}}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
